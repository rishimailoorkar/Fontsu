<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Font Details - Namma Fontsu</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Manrope:wght@200;400;500;600;700;800&family=Noto+Sans+Kannada:wght@400;700&family=Noto+Sans+Bengali:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&family=Permanent+Marker&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#F5F5F0',
            text: '#111111',
            card: '#E2E2DC',
            teal: '#007F8C',
            highlight: '#E6B325',
            dark: '#0C0C0C',
            white: '#ffffff',
          },
          fontFamily: {
            sans: ['Manrope', 'sans-serif'],
            display: ['Space Grotesk', 'sans-serif'],
            brush: ['"Permanent Marker"', 'cursive'],
            kannada: ['"Noto Sans Kannada"', 'sans-serif'],
            hindi: ['"Noto Sans Devanagari"', 'sans-serif'],
            bengali: ['"Noto Sans Bengali"', 'sans-serif'],
          }
        }
      }
    }
  </script>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col selection:bg-teal selection:text-white">

  <!-- Texture Overlay -->
  <div class="texture-overlay"></div>

  <!-- NAVIGATION -->
  <nav class="sticky top-0 z-50 bg-bg/95 backdrop-blur-md border-b-2 border-text">
    <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
      <!-- Logo -->
      <a href="index.html" class="flex flex-col items-start leading-none group">
        <div class="text-xl font-brush text-text tracking-wide scale-y-110">NAMMA</div>
        <div class="text-xl font-brush text-text tracking-wide relative scale-y-110">
          FONTSU
          <span class="absolute -bottom-1 left-0 w-full h-1 bg-teal rounded-full transform scale-x-100 origin-left group-hover:scale-x-110 transition-transform"></span>
        </div>
      </a>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center gap-8 font-bold text-sm">
        <a href="fonts.html" class="hover:text-teal uppercase tracking-wider text-teal">All Fonts</a>
        <a href="designers.html" class="hover:text-teal uppercase tracking-wider">Designers</a>
        <a href="about.html" class="hover:text-teal uppercase tracking-wider">About</a>
      </div>

      <!-- Actions -->
      <div class="flex items-center gap-4">
        <button onclick="window.location.href='cart.html'" class="relative p-2 hover:text-teal transition-colors">
          <i class="fa-solid fa-shopping-bag text-xl"></i>
          <span id="cart-badge" class="absolute top-0 right-0 w-4 h-4 bg-teal text-white text-[10px] flex items-center justify-center rounded-full font-bold hidden">0</span>
        </button>
        <button onclick="window.location.href='auth.html'" class="hidden md:block btn-outline py-2 px-6 text-xs uppercase tracking-widest">
          Log In
        </button>
        <button class="md:hidden text-text text-xl"><i class="fa-solid fa-bars"></i></button>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="flex-1 w-full max-w-7xl mx-auto p-6 md:p-12 relative z-10">
    
    <!-- Loading State -->
    <div id="loading" class="text-center py-20">
      <i class="fa-solid fa-spinner fa-spin text-4xl text-teal mb-4"></i>
      <p class="font-bold text-text/60">Loading font details...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="hidden text-center py-20">
      <i class="fa-solid fa-exclamation-triangle text-4xl text-red-600 mb-4"></i>
      <p class="font-bold text-text/60 mb-4">Font not found</p>
      <a href="fonts.html" class="btn-primary inline-block">Browse All Fonts</a>
    </div>

    <!-- Font Detail Content -->
    <div id="fontDetail" class="hidden">
      <!-- Breadcrumb -->
      <div class="mb-6">
        <a href="fonts.html" class="text-text/60 hover:text-teal font-bold text-sm">
          <i class="fa-solid fa-arrow-left mr-2"></i>Back to All Fonts
        </a>
      </div>

      <!-- Font Header -->
      <div class="mb-8">
        <h1 id="fontName" class="font-display text-5xl font-bold mb-4"></h1>
        <p class="text-lg text-text/80 mb-6">
          <span class="font-bold">Designer:</span> <span id="fontDesigner" class="text-teal"></span>
        </p>
        <div class="flex flex-wrap gap-3 mb-6">
          <span id="fontScript" class="inline-block px-4 py-2 bg-teal text-white border-2 border-text text-sm font-bold uppercase"></span>
          <span id="fontCategory" class="inline-block px-4 py-2 bg-highlight text-text border-2 border-text text-sm font-bold uppercase"></span>
          <span id="fontGlyphs" class="inline-block px-4 py-2 bg-white text-text border-2 border-text text-sm font-bold"></span>
        </div>
        <p id="fontDescription" class="text-text/80 leading-relaxed max-w-3xl"></p>
      </div>

      <!-- Main Content Grid: Preview + Pricing -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Font Preview Section -->
        <div class="lg:col-span-2 bg-white border-2 border-text shadow-raw p-8">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold uppercase tracking-widest">Live Preview</h3>
            <div class="flex gap-4 items-center">
              <label class="text-sm font-bold">Size:</label>
              <input type="range" min="24" max="120" value="48" id="previewSize" 
                     class="w-32" onchange="updatePreviewSize(this.value)">
              <span id="sizeDisplay" class="text-sm font-bold w-12">48px</span>
            </div>
          </div>
          
          <!-- Language Selector and Translate -->
          <div class="flex gap-3 mb-4 items-center flex-wrap">
            <button onclick="switchLanguage('en')" class="px-3 py-1 text-xs border-2 border-text font-bold hover:bg-text hover:text-white transition-colors" id="lang-en">English</button>
            <button onclick="switchLanguage('kn')" class="px-3 py-1 text-xs border-2 border-text font-bold hover:bg-text hover:text-white transition-colors" id="lang-kn">ಕನ್ನಡ</button>
            <button onclick="switchLanguage('hi')" class="px-3 py-1 text-xs border-2 border-text font-bold hover:bg-text hover:text-white transition-colors" id="lang-hi">हिंदी</button>
            <button onclick="switchLanguage('bn')" class="px-3 py-1 text-xs border-2 border-text font-bold hover:bg-text hover:text-white transition-colors" id="lang-bn">বাংলা</button>
            <button onclick="switchLanguage('ta')" class="px-3 py-1 text-xs border-2 border-text font-bold hover:bg-text hover:text-white transition-colors" id="lang-ta">தமிழ்</button>
          </div>          <div class="border-2 border-text bg-bg p-8 mb-4">
          <div id="livePreview" class="text-center custom-font-preview" style="font-size: 48px; font-family: inherit;">
            The quick brown fox jumps over the lazy dog
          </div>
        </div>          <input type="text" 
                 id="previewText" 
                 placeholder="Type to preview..." 
                 class="w-full bg-bg border-2 border-text p-4 font-bold focus:outline-none focus:border-teal"
                 onkeyup="updatePreview(this.value)">
        </div>

        <!-- Pricing Card -->
        <div class="bg-white border-2 border-text shadow-raw p-8 lg:sticky lg:top-24 h-fit">
          <h3 class="font-bold uppercase tracking-widest mb-6 border-b-2 border-text pb-2">Licensing</h3>
          
          <div class="space-y-4 mb-6">
            <div class="border-2 border-text p-4">
              <div class="text-xs font-bold uppercase tracking-wider text-text/60 mb-1">Personal Use</div>
              <div class="font-display text-3xl font-bold">₹<span id="pricePersonal">0</span></div>
              <div class="text-xs text-text/60 mt-2">For personal projects</div>
            </div>
            
            <div class="border-2 border-text p-4 bg-teal/5">
              <div class="text-xs font-bold uppercase tracking-wider text-text/60 mb-1">Commercial Use</div>
              <div class="font-display text-3xl font-bold">₹<span id="priceCommercial">0</span></div>
              <div class="text-xs text-text/60 mt-2">For commercial projects</div>
            </div>
          </div>

          <button onclick="addToCart()" class="btn-primary w-full mb-3">
            <i class="fa-solid fa-shopping-bag mr-2"></i>Add to Cart
          </button>
          <button onclick="downloadFont()" class="btn-outline w-full">
            <i class="fa-solid fa-download mr-2"></i>Download Sample
          </button>
        </div>
      </div>

      <!-- Character Set Preview -->
      <div class="bg-white border-2 border-text shadow-raw p-8 mb-8">
        <h3 class="font-bold uppercase tracking-widest mb-6">Character Set</h3>
        <div class="grid grid-cols-8 md:grid-cols-12 gap-4">
          <div class="border border-text/20 p-4 text-center" id="charsetPreview">
            <div class="text-2xl mb-1">A</div>
            <div class="text-xs text-text/40">A</div>
          </div>
          <!-- Characters will be populated by JavaScript -->
        </div>
      </div>

      <!-- Font Specimens -->
      <div class="bg-white border-2 border-text shadow-raw p-8">
        <h3 class="font-bold uppercase tracking-widest mb-6">Type Specimens</h3>
        <div class="space-y-8">
          <div>
            <div class="text-xs font-bold uppercase tracking-wider text-text/60 mb-2">Large Display</div>
            <div id="specimen1" class="font-display" style="font-size: 72px; line-height: 1.1;">Typography</div>
          </div>
          <div>
            <div class="text-xs font-bold uppercase tracking-wider text-text/60 mb-2">Medium Heading</div>
            <div id="specimen2" class="font-display" style="font-size: 48px; line-height: 1.2;">Beautiful Design</div>
          </div>
          <div>
            <div class="text-xs font-bold uppercase tracking-wider text-text/60 mb-2">Body Text</div>
            <div id="specimen3" class="font-display" style="font-size: 18px; line-height: 1.6;">
              The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs. 
              How vexingly quick daft zebras jump! The five boxing wizards jump quickly.
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- FOOTER -->
  <footer class="bg-text text-white py-12 border-t-4 border-teal relative z-10 mt-12">
    <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8">
      <div class="md:col-span-2">
        <h3 class="font-brush text-2xl mb-4">NAMMA FONTSU</h3>
        <p class="text-white/60 max-w-sm">A platform for designers to discover, preview, and license authentic Indian regional typefaces. Designed for culture.</p>
      </div>
      <div>
        <h4 class="font-bold uppercase tracking-widest text-teal mb-4 text-xs">Platform</h4>
        <ul class="space-y-2 text-sm text-white/80">
          <li><a href="fonts.html" class="hover:text-white">Browse Fonts</a></li>
          <li><a href="designers.html" class="hover:text-white">Sell Your Fonts</a></li>
          <li><a href="#" class="hover:text-white">Licensing Terms</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold uppercase tracking-widest text-teal mb-4 text-xs">Connect</h4>
        <ul class="space-y-2 text-sm text-white/80">
          <li><a href="#" class="hover:text-white">Instagram</a></li>
          <li><a href="#" class="hover:text-white">Twitter / X</a></li>
          <li><a href="#" class="hover:text-white">Support</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Dynamic Font Styles -->
  <style id="customFontStyle"></style>

  <!-- JavaScript -->
  <script src="js/app.js"></script>
  <script src="js/cart.js"></script>
  <script>
    let currentFont = null;
    let currentLanguage = 'en';

    // Get font ID from URL
    function getFontId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    // Fetch font details
    async function loadFontDetails() {
      const fontId = getFontId();
      
      if (!fontId) {
        showError();
        return;
      }

      try {
        // Try to fetch from API first
        const response = await fetch(`php/get_fonts.php?status=approved`);
        const result = await response.json();
        
        if (result.success) {
          currentFont = result.data.find(f => f.id == fontId);
        }
        
        // Fallback to static fonts if not found
        if (!currentFont && typeof db !== 'undefined') {
          currentFont = db.fonts.find(f => f.id == fontId);
        }
        
        if (currentFont) {
          displayFont(currentFont);
        } else {
          showError();
        }
      } catch (error) {
        console.error('Error loading font:', error);
        // Try static fonts as fallback
        if (typeof db !== 'undefined') {
          currentFont = db.fonts.find(f => f.id == fontId);
          if (currentFont) {
            displayFont(currentFont);
          } else {
            showError();
          }
        } else {
          showError();
        }
      }
    }

    // Load custom font file
    function loadCustomFont(font) {
      if (font.fileUrl && font.fileName) {
        const fontName = 'CustomFont_' + font.id;
        const fontStyle = document.getElementById('customFontStyle');
        
        // Determine font format
        const ext = font.fileExtension || 'ttf';
        const format = ext === 'woff2' ? 'woff2' : ext === 'woff' ? 'woff' : ext === 'otf' ? 'opentype' : 'truetype';
        
        fontStyle.textContent = `
          @font-face {
            font-family: '${fontName}';
            src: url('${font.fileUrl}') format('${format}');
            font-weight: normal;
            font-style: normal;
          }
          .custom-font-preview,
          #specimen1,
          #specimen2,
          #specimen3 {
            font-family: '${fontName}', sans-serif !important;
          }
        `;
      }
    }

    // Display font details
    function displayFont(font) {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('fontDetail').classList.remove('hidden');

      // Load custom font file
      loadCustomFont(font);

      // Update title
      document.title = `${font.name} - Namma Fontsu`;

      // Fill in details
      document.getElementById('fontName').textContent = font.name;
      document.getElementById('fontDesigner').textContent = font.designer;
      document.getElementById('fontScript').textContent = font.script;
      document.getElementById('fontCategory').textContent = font.category;
      document.getElementById('fontGlyphs').textContent = `${font.glyphs || 250}+ Glyphs`;
      document.getElementById('fontDescription').textContent = font.description || 
        `${font.name} is a beautiful ${font.category.toLowerCase()} typeface designed for ${font.script} script. Perfect for both print and digital projects.`;
      
      document.getElementById('pricePersonal').textContent = font.pricePersonal || font.price || 499;
      document.getElementById('priceCommercial').textContent = font.priceCommercial || (font.price * 5) || 2499;

      // Update preview text based on script
      const previewTexts = {
        'Kannada': 'ನಮ್ಮ ಫಾಂಟ್ ಸುಂದರವಾಗಿದೆ',
        'Devanagari': 'हमारा फ़ॉन्ट सुंदर है',
        'Bengali': 'আমাদের ফন্ট সুন্দর',
        'Tamil': 'எங்கள் எழுத்துரு அழகாக உள்ளது'
      };
      
      const defaultPreview = previewTexts[font.script] || 'Beautiful Typography';
      document.getElementById('livePreview').textContent = defaultPreview;
      document.getElementById('previewText').placeholder = `Type in ${font.script}...`;

      // Update specimen texts
      document.getElementById('specimen1').textContent = font.name || 'Typography';
      document.getElementById('specimen2').textContent = defaultPreview;
      document.getElementById('specimen3').textContent = defaultPreview + ' ' + (font.name || '');

      // Show character set
      generateCharacterSet(font.script);
      
      // Set initial language based on script
      const scriptLangMap = {
        'Kannada': 'kn',
        'Devanagari': 'hi',
        'Bengali': 'bn',
        'Tamil': 'ta'
      };
      switchLanguage(scriptLangMap[font.script] || 'en');
    }

    // Show error state
    function showError() {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error').classList.remove('hidden');
    }

    // Switch language
    function switchLanguage(lang) {
      currentLanguage = lang;
      
      // Update active button
      document.querySelectorAll('[id^="lang-"]').forEach(btn => {
        btn.classList.remove('bg-text', 'text-white');
      });
      const activeBtn = document.getElementById('lang-' + lang);
      if (activeBtn) {
        activeBtn.classList.add('bg-text', 'text-white');
      }
      
      // Set sample text based on language
      const sampleTexts = {
        'en': 'Beautiful Typography',
        'kn': 'ನಮ್ಮ ಫಾಂಟ್ ಸುಂದರವಾಗಿದೆ',
        'hi': 'हमारा फ़ॉन्ट सुंदर है',
        'bn': 'আমাদের ফন্ট সুন্দর',
        'ta': 'எங்கள் எழுத்துரு அழகாக உள்ளது'
      };
      
      if (!document.getElementById('previewText').value) {
        document.getElementById('livePreview').textContent = sampleTexts[lang] || sampleTexts['en'];
      }
    }

    // Update preview text
    function updatePreview(text) {
      if (text) {
        document.getElementById('livePreview').textContent = text;
      } else {
        // Reset to default for current language
        const sampleTexts = {
          'en': 'Beautiful Typography',
          'kn': 'ನಮ್ಮ ಫಾಂಟ್ ಸುಂದರವಾಗಿದೆ',
          'hi': 'हमारा फ़ॉन्ट सुंदर है',
          'bn': 'আমাদের ফন্ট সুন্দর',
          'ta': 'எங்கள் எழுத்துரு அழகாக உள்ளது'
        };
        document.getElementById('livePreview').textContent = sampleTexts[currentLanguage] || sampleTexts['en'];
      }
    }

    // Update preview size
    function updatePreviewSize(size) {
      document.getElementById('livePreview').style.fontSize = size + 'px';
      document.getElementById('sizeDisplay').textContent = size + 'px';
    }

    // Generate character set preview
    function generateCharacterSet(script) {
      const container = document.getElementById('charsetPreview').parentElement;
      container.innerHTML = '';
      
      let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      
      if (script === 'Kannada') {
        characters = 'ಅಆಇಈಉಊಋಎಏಐಒಓಔಕಖಗಘಙಚಛಜಝಞಟಠಡಢಣತಥದಧನಪಫಬಭಮಯರಲವಶಷಸಹಳ';
      } else if (script === 'Devanagari') {
        characters = 'अआइईउऊऋएऐओऔकखगघङचछजझञटठडढणतथदधनपफबभमयरलवशषसह';
      } else if (script === 'Bengali') {
        characters = 'অআইঈউঊঋএঐওঔকখগঘঙচছজঝঞটঠডঢণতথদধনপফবভমযরলশষসহ';
      }
      
      for (let char of characters) {
        container.innerHTML += `
          <div class="border border-text/20 p-4 text-center hover:bg-bg transition-colors">
            <div class="text-2xl mb-1 font-display">${char}</div>
            <div class="text-xs text-text/40">${char}</div>
          </div>
        `;
      }
    }

    // Add to cart
    function addToCart() {
      if (currentFont && window.cartManager) {
        const licenseType = 'personal'; // Default to personal, could be changed based on user selection
        const result = window.cartManager.addItem(currentFont, licenseType);
        
        if (result.success) {
          // Show success message
          const btn = event.target.closest('button');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i>Added to Cart!';
          btn.classList.add('bg-teal');
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('bg-teal');
          }, 2000);
        } else {
          alert(result.message);
        }
      }
    }

    // Download font
    function downloadFont() {
      if (currentFont && currentFont.fileUrl) {
        window.open(currentFont.fileUrl, '_blank');
      } else {
        alert('Sample download coming soon!');
      }
    }

    // Load on page ready
    document.addEventListener('DOMContentLoaded', loadFontDetails);
  </script>
</body>
</html>
