<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Namma Fontsu - Indian Regional Font Platform</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Manrope:wght@200;400;500;600;700;800&family=Noto+Sans+Kannada:wght@400;700&family=Noto+Sans+Bengali:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&family=Permanent+Marker&display=swap" rel="stylesheet">
<!-- Chart.js for Dashboard -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          bg: '#F5F5F0',          /* Primary Background */
          text: '#111111',        /* Primary Text */
          card: '#E2E2DC',        /* Card Background */
          teal: '#007F8C',        /* Brand Accent */
          highlight: '#E6B325',   /* Rare Highlight */
          dark: '#0C0C0C',        /* Dark Mode */
          white: '#ffffff',
        },
        fontFamily: {
          sans: ['Manrope', 'sans-serif'],
          display: ['Space Grotesk', 'sans-serif'],
          brush: ['"Permanent Marker"', 'cursive'], 
          kannada: ['"Noto Sans Kannada"', 'sans-serif'],
          hindi: ['"Noto Sans Devanagari"', 'sans-serif'],
          bengali: ['"Noto Sans Bengali"', 'sans-serif'],
        },
        boxShadow: {
          'raw': '4px 4px 0px 0px #111111',
          'raw-hover': '2px 2px 0px 0px #111111',
          'raw-teal': '4px 4px 0px 0px #007F8C',
        }
      }
    }
  }
</script>

<style>
  /* Global Raw Aesthetic */
  body {
    background-color: #F5F5F0;
    color: #111111;
  }

  /* Texture Overlay */
  .texture-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuNjUiIG51bU9jdGF2ZXM9IjMiIHN0aXRjaFRpbGVzPSJzdGl0Y2giLz48L2ZpbHRlcj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWx0ZXI9InVybCgjbm9pc2UpIiBvcGFjaXR5PSIwLjAzIi8+PC9zdmc+');
    pointer-events: none;
    z-index: 9999;
    opacity: 0.5;
  }

  /* Raw Components */
  .btn-primary {
    background-color: #111111;
    color: white;
    font-weight: 700;
    padding: 12px 24px;
    border: 2px solid #111111;
    box-shadow: 4px 4px 0px #007F8C;
    transition: all 0.2s ease;
  }
  .btn-primary:hover {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0px #007F8C;
  }
  .btn-primary:active {
    transform: translate(4px, 4px);
    box-shadow: none;
  }

  .btn-outline {
    background: transparent;
    color: #111111;
    font-weight: 700;
    padding: 12px 24px;
    border: 2px solid #111111;
    transition: all 0.2s ease;
  }
  .btn-outline:hover {
    background: #111111;
    color: white;
  }

  .card-raw {
    background: #E2E2DC; /* Secondary BG */
    border: 2px solid #111111;
    padding: 24px;
    transition: transform 0.2s;
  }
  .card-raw:hover {
    transform: translateY(-4px);
    border-color: #007F8C;
  }

  /* Custom Range Slider */
  input[type=range] {
    -webkit-appearance: none; background: transparent; 
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 20px; width: 20px;
    border-radius: 50%; background: #007F8C;
    border: 2px solid #111111; cursor: pointer;
    margin-top: -8px; 
  }
  input[type=range]::-webkit-slider-runnable-track {
    width: 100%; height: 4px; background: #111111;
  }

  /* Hide Scrollbar */
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  
  /* Loading Spinner */
  .loader { border: 4px solid #f3f3f3; border-top: 4px solid #007F8C; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col selection:bg-teal selection:text-white">

<!-- Texture -->
<div class="texture-overlay"></div>

<!-- NAVIGATION -->
<nav class="sticky top-0 z-50 bg-bg/95 backdrop-blur-md border-b-2 border-text">
  <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
    <!-- Logo -->
    <a href="#home" class="flex flex-col items-start leading-none group" onclick="navigate('home')">
      <div class="text-xl font-brush text-text tracking-wide scale-y-110">NAMMA</div>
      <div class="text-xl font-brush text-text tracking-wide relative scale-y-110">
        FONTSU
        <span class="absolute -bottom-1 left-0 w-full h-1 bg-teal rounded-full transform scale-x-100 origin-left group-hover:scale-x-110 transition-transform"></span>
      </div>
    </a>

    <!-- Desktop Menu -->
    <div class="hidden md:flex items-center gap-8 font-bold text-sm">
      <a href="#fonts" onclick="navigate('fonts')" class="hover:text-teal uppercase tracking-wider">All Fonts</a>
      <a href="#dashboard" onclick="navigate('dashboard')" class="hover:text-teal uppercase tracking-wider">Designers</a>
      <a href="#about" class="hover:text-teal uppercase tracking-wider">About</a>
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-4">
      <button onclick="navigate('cart')" class="relative p-2 hover:text-teal transition-colors">
        <i class="fa-solid fa-shopping-bag text-xl"></i>
        <span id="cart-badge" class="absolute top-0 right-0 w-4 h-4 bg-teal text-white text-[10px] flex items-center justify-center rounded-full font-bold hidden">0</span>
      </button>
      <button onclick="navigate('login')" class="hidden md:block btn-outline py-2 px-6 text-xs uppercase tracking-widest">
        Log In
      </button>
      <button class="md:hidden text-text text-xl"><i class="fa-solid fa-bars"></i></button>
    </div>
  </div>
</nav>

<!-- MAIN APP CONTAINER -->
<main id="app" class="flex-1 w-full max-w-7xl mx-auto p-6 md:p-12 min-h-screen relative z-10">
  <!-- Content injected by Router -->
</main>

<!-- FOOTER -->
<footer class="bg-text text-white py-12 border-t-4 border-teal relative z-10">
  <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8">
    <div class="md:col-span-2">
      <h3 class="font-brush text-2xl mb-4">NAMMA FONTSU</h3>
      <p class="text-white/60 max-w-sm">A platform for designers to discover, preview, and license authentic Indian regional typefaces. Designed for culture.</p>
    </div>
    <div>
      <h4 class="font-bold uppercase tracking-widest text-teal mb-4 text-xs">Platform</h4>
      <ul class="space-y-2 text-sm text-white/80">
        <li><a href="#" class="hover:text-white">Browse Fonts</a></li>
        <li><a href="#" class="hover:text-white">Sell Your Fonts</a></li>
        <li><a href="#" class="hover:text-white">Licensing Terms</a></li>
      </ul>
    </div>
    <div>
      <h4 class="font-bold uppercase tracking-widest text-teal mb-4 text-xs">Connect</h4>
      <ul class="space-y-2 text-sm text-white/80">
        <li><a href="#" class="hover:text-white">Instagram</a></li>
        <li><a href="#" class="hover:text-white">Twitter / X</a></li>
        <li><a href="#" class="hover:text-white">Support</a></li>
      </ul>
    </div>
  </div>
</footer>

<!-- TEMPLATES (Hidden, used by JS Router) -->

<!-- 1. HOME VIEW -->
<template id="view-home">
  <div class="flex flex-col lg:flex-row gap-16 items-center min-h-[60vh] mb-20">
    <div class="lg:w-1/2 space-y-8">
      <div class="inline-block px-3 py-1 border-2 border-text bg-highlight text-text text-xs font-bold uppercase tracking-wider shadow-[2px_2px_0px_#111]">
        The Marketplace for India
      </div>
      <h1 class="font-display text-7xl md:text-9xl font-bold text-text leading-[0.9]">
        Design in <br> <span class="text-teal">your language.</span>
      </h1>
      <p class="text-xl font-medium text-text/70 max-w-lg border-l-4 border-teal pl-6">
        Discover and license high-quality typefaces for Kannada, Hindi, Bengali, and more. Authentic. Expressive. Done right.
      </p>
      <div class="flex gap-4 pt-4">
        <button onclick="navigate('fonts')" class="btn-primary">BROWSE MARKETPLACE</button>
        <button onclick="navigate('dashboard')" class="btn-outline">SELL FONTS</button>
      </div>
    </div>
    <div class="lg:w-1/2 w-full perspective-1000">
      <div class="bg-white border-2 border-text p-2 shadow-raw rotate-2 hover:rotate-0 transition-transform duration-300">
        <div class="bg-card border border-text/20 p-8 min-h-[400px] flex flex-col items-center justify-center relative overflow-hidden">
          <div class="absolute top-4 right-4 text-[10px] font-mono text-text/40">LIVE PREVIEW</div>
          <h2 id="home-demo-text" class="text-6xl md:text-8xl font-bold text-text text-center font-kannada" contenteditable="true">ನಮಸ್ಕಾರ</h2>
          <p class="mt-4 text-sm text-text/50 uppercase tracking-widest">Try typing above</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Featured Section -->
  <div class="mb-20">
    <div class="flex justify-between items-end mb-8 border-b-2 border-text pb-4">
      <h2 class="font-display text-4xl font-bold">New Drops</h2>
      <button onclick="navigate('fonts')" class="text-teal font-bold hover:underline">View All <i class="fa-solid fa-arrow-right ml-2"></i></button>
    </div>
    <div id="home-featured-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <!-- Injected by JS -->
    </div>
  </div>
</template>

<!-- 2. MARKETPLACE VIEW (Fonts) -->
<template id="view-fonts">
  <div class="flex flex-col lg:flex-row gap-12">
    <!-- Sidebar Filters -->
    <div class="lg:w-1/4 space-y-8">
      <div class="bg-white p-6 border-2 border-text shadow-raw">
        <h3 class="font-display text-xl font-bold mb-6 flex items-center gap-2"><i class="fa-solid fa-filter text-teal"></i> Filters</h3>
        
        <!-- Script Filter -->
        <div class="mb-6">
          <label class="block text-xs font-bold uppercase tracking-widest text-text/50 mb-3">Script</label>
          <div class="space-y-2" id="filter-script">
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Kannada" class="accent-teal"> Kannada</label>
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Devanagari" class="accent-teal"> Devanagari</label>
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Bengali" class="accent-teal"> Bengali</label>
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Tamil" class="accent-teal"> Tamil</label>
          </div>
        </div>

        <!-- Category Filter -->
        <div class="mb-6">
          <label class="block text-xs font-bold uppercase tracking-widest text-text/50 mb-3">Style</label>
          <div class="space-y-2" id="filter-cat">
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Display" class="accent-teal"> Display</label>
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Serif" class="accent-teal"> Text / Serif</label>
            <label class="flex items-center gap-2 cursor-pointer hover:text-teal"><input type="checkbox" value="Handwritten" class="accent-teal"> Handwritten</label>
          </div>
        </div>

        <button onclick="applyFilters()" class="w-full btn-primary text-sm py-2">Apply Filters</button>
      </div>
    </div>

    <!-- Font Grid -->
    <div class="lg:w-3/4">
      <div class="flex justify-between items-center mb-6">
        <span class="text-sm font-bold text-text/60" id="font-count">Showing all fonts</span>
        <select class="bg-transparent border-b-2 border-text font-bold text-sm focus:outline-none p-2 cursor-pointer">
          <option>Newest First</option>
          <option>Popular</option>
          <option>Price: Low to High</option>
        </select>
      </div>

      <!-- Live Type Tester Bar -->
      <div class="sticky top-24 z-30 bg-bg/95 backdrop-blur border-2 border-text p-4 mb-8 shadow-raw flex gap-4 items-center">
        <input type="text" id="global-preview-text" placeholder="Type something to preview all..." class="flex-1 bg-transparent border-none outline-none font-bold text-lg placeholder-text/30" oninput="updateAllPreviews(this.value)">
        <div class="flex items-center gap-2 w-32">
          <i class="fa-solid fa-text-height text-xs"></i>
          <input type="range" min="20" max="72" value="32" class="w-full" oninput="updateAllSizes(this.value)">
        </div>
      </div>

      <div id="fonts-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Injected by JS -->
      </div>
    </div>
  </div>
</template>

<!-- 3. FONT DETAIL VIEW -->
<template id="view-detail">
  <div class="bg-white border-2 border-text shadow-raw-teal mb-12">
    <!-- Header -->
    <div class="p-8 md:p-12 border-b-2 border-text bg-bg flex flex-col md:flex-row justify-between gap-8">
      <div>
        <div class="flex items-center gap-3 mb-2">
          <h1 id="detail-name" class="font-display text-5xl md:text-6xl font-bold">Font Name</h1>
          <span id="detail-badge" class="bg-highlight border border-text px-2 py-1 text-xs font-bold uppercase tracking-widest">New</span>
        </div>
        <div class="flex items-center gap-4 text-sm font-bold text-text/60">
          <span id="detail-author">By Author</span>
          <span>•</span>
          <span id="detail-script">Script</span>
          <span>•</span>
          <span id="detail-glyphs">0 Glyphs</span>
        </div>
      </div>
      <div class="text-right">
        <div id="detail-price" class="font-display text-4xl font-bold text-teal">₹0</div>
        <div class="text-xs font-bold uppercase tracking-widest text-text/40">Personal License</div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row min-h-[600px]">
      <!-- Playground -->
      <div class="lg:w-3/4 p-8 border-r-2 border-text relative bg-white">
        <div class="flex justify-between items-center mb-4">
           <div class="flex gap-2">
             <button onclick="setFontScriptPreview('kannada')" class="px-2 py-1 text-xs border border-text font-bold hover:bg-text hover:text-white">Ka</button>
             <button onclick="setFontScriptPreview('english')" class="px-2 py-1 text-xs border border-text font-bold hover:bg-text hover:text-white">En</button>
           </div>
           <div class="flex items-center gap-2">
             <span class="text-xs font-bold">Size</span>
             <input type="range" min="32" max="150" value="80" oninput="document.getElementById('detail-input').style.fontSize = this.value + 'px'">
           </div>
        </div>
        <textarea id="detail-input" class="w-full h-full bg-transparent border-none outline-none resize-none text-8xl font-bold leading-tight placeholder-text/20" spellcheck="false">Aa</textarea>
      </div>

      <!-- Purchasing -->
      <div class="lg:w-1/4 p-8 bg-card flex flex-col gap-6">
        <h3 class="font-bold uppercase tracking-widest border-l-4 border-teal pl-2">Select License</h3>
        
        <label class="block bg-white border-2 border-text p-4 cursor-pointer hover:border-teal transition-colors relative group">
          <input type="radio" name="license" value="personal" checked class="peer sr-only" onchange="updateLicensePrice('personal')">
          <div class="flex justify-between items-start mb-1">
            <span class="font-bold">Personal</span>
            <div class="w-4 h-4 rounded-full border-2 border-text peer-checked:bg-teal"></div>
          </div>
          <p class="text-xs text-text/60">1 User, Desktop only. No web usage.</p>
        </label>

        <label class="block bg-white border-2 border-text p-4 cursor-pointer hover:border-teal transition-colors relative group">
          <input type="radio" name="license" value="commercial" class="peer sr-only" onchange="updateLicensePrice('commercial')">
          <div class="flex justify-between items-start mb-1">
            <span class="font-bold">Commercial</span>
            <div class="w-4 h-4 rounded-full border-2 border-text peer-checked:bg-teal"></div>
          </div>
          <p class="text-xs text-text/60">Unlimited Users, Web & Print.</p>
        </label>

        <div class="mt-auto pt-6 border-t border-text/20">
          <button id="add-to-cart-btn" class="w-full btn-primary py-4 text-sm uppercase tracking-widest shadow-raw hover:shadow-none transition-all">
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- 4. DASHBOARD VIEW (Designer) -->
<template id="view-dashboard">
  <div class="mb-8 flex justify-between items-end">
    <div>
      <h1 class="font-display text-4xl font-bold mb-1">Designer Dashboard</h1>
      <p class="text-text/60 font-bold">Welcome back, <span class="text-teal">Umesh</span></p>
    </div>
    <div class="text-right">
      <div class="text-xs font-bold uppercase tracking-widest text-text/40">Total Earnings</div>
      <div class="font-display text-3xl font-bold">₹12,540</div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
    <!-- Upload Card -->
    <div class="lg:col-span-2 bg-white border-2 border-text shadow-raw p-8">
      <h3 class="font-bold uppercase tracking-widest mb-6 border-b-2 border-text pb-2">Upload New Font</h3>
      <form onsubmit="handleUpload(event)" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <input type="text" placeholder="Font Name" class="w-full bg-bg border-2 border-text p-3 font-bold focus:outline-none focus:border-teal" required>
          <select class="w-full bg-bg border-2 border-text p-3 font-bold focus:outline-none focus:border-teal">
            <option>Kannada</option>
            <option>Devanagari</option>
            <option>Bengali</option>
            <option>Tamil</option>
          </select>
        </div>
        <div class="border-2 border-dashed border-text bg-bg p-8 text-center cursor-pointer hover:bg-white transition-colors">
          <i class="fa-solid fa-cloud-arrow-up text-2xl mb-2"></i>
          <p class="font-bold text-sm">Drag & drop .OTF / .TTF files</p>
        </div>
        <button type="submit" class="btn-primary w-full">Submit for Review</button>
      </form>
    </div>

    <!-- Stats -->
    <div class="bg-dark text-white border-2 border-text shadow-raw p-8">
      <h3 class="font-bold uppercase tracking-widest mb-6 text-teal">Analytics</h3>
      <canvas id="revenueChart" height="200"></canvas>
      <div class="mt-4 text-center text-sm text-white/60">Last 30 Days Activity</div>
    </div>
  </div>
</template>

<!-- 5. CART VIEW -->
<template id="view-cart">
  <h1 class="font-display text-4xl font-bold mb-8">Your Cart</h1>
  <div class="flex flex-col lg:flex-row gap-12">
    <div class="lg:w-2/3 space-y-4" id="cart-items">
      <!-- Items injected here -->
      <div class="bg-white border-2 border-text p-8 text-center text-text/40 font-bold">
        Your cart is empty.
      </div>
    </div>
    <div class="lg:w-1/3">
      <div class="bg-card border-2 border-text p-8 sticky top-24">
        <h3 class="font-bold text-xl mb-4">Summary</h3>
        <div class="flex justify-between mb-2 font-bold text-sm text-text/60">
          <span>Subtotal</span>
          <span id="cart-subtotal">₹0</span>
        </div>
        <div class="flex justify-between mb-6 font-bold text-sm text-text/60">
          <span>Tax (18%)</span>
          <span id="cart-tax">₹0</span>
        </div>
        <div class="flex justify-between mb-8 font-display text-2xl font-bold border-t-2 border-text pt-4">
          <span>Total</span>
          <span id="cart-total">₹0</span>
        </div>
        <button onclick="alert('Proceeding to Stripe/Razorpay Payment Gateway...')" class="w-full btn-primary">Checkout</button>
      </div>
    </div>
  </div>
</template>

<!-- JS APP LOGIC -->
<script>
  // --- MOCK DATABASE ---
  const db = {
    fonts: [
      { 
        id: 1, name: "Hombe Display", designer: "R. Designer", script: "Kannada", category: "Display", 
        pricePersonal: 499, priceCommercial: 2499, glyphs: 540, 
        tags: ["Retro", "Bold"], fontClass: "font-kannada", previewText: "ಕರ್ನಾಟಕ" 
      },
      { 
        id: 2, name: "Malgudi Serif", designer: "Type Studio", script: "Devanagari", category: "Serif", 
        pricePersonal: 0, priceCommercial: 1299, glyphs: 420, 
        tags: ["Classic", "Book"], fontClass: "font-hindi", previewText: "मालगुडी" 
      },
      { 
        id: 3, name: "Bengal Tiger", designer: "Kolkata Types", script: "Bengali", category: "Display", 
        pricePersonal: 699, priceCommercial: 3000, glyphs: 600, 
        tags: ["Aggressive", "Brush"], fontClass: "font-bengali", previewText: "বাঘ" 
      },
      { 
        id: 4, name: "Tech Bengaluru", designer: "Pixel Arts", script: "Kannada", category: "Sans", 
        pricePersonal: 899, priceCommercial: 4000, glyphs: 300, 
        tags: ["Modern", "Tech"], fontClass: "font-kannada", previewText: "ತಂತ್ರಜ್ಞಾನ" 
      },
      { 
        id: 5, name: "Chai Shop", designer: "Desi Art", script: "Devanagari", category: "Handwritten", 
        pricePersonal: 299, priceCommercial: 1500, glyphs: 200, 
        tags: ["Casual", "Menu"], fontClass: "font-hindi", previewText: "चाय" 
      },
    ],
    cart: [],
    user: { name: "Umesh", role: "designer" }
  };

  // --- STATE ---
  let currentRoute = 'home';
  
  // --- ROUTER ---
  function navigate(route, params = null) {
    currentRoute = route;
    const app = document.getElementById('app');
    window.scrollTo(0,0);
    
    // Clear content
    app.innerHTML = '';

    // Load Template
    const templateId = `view-${route}`;
    const template = document.getElementById(templateId);
    
    if(template) {
      const clone = template.content.cloneNode(true);
      app.appendChild(clone);
      
      // Initialize View Logic
      if (route === 'home') initHome();
      if (route === 'fonts') initFonts();
      if (route === 'detail') initDetail(params);
      if (route === 'dashboard') initDashboard();
      if (route === 'cart') initCart();
    } else {
      app.innerHTML = `<h1 class="text-4xl font-bold">404 - Page Not Found</h1>`;
    }
  }

  // --- VIEW CONTROLLERS ---

  function initHome() {
    const grid = document.getElementById('home-featured-grid');
    // Show top 3 fonts
    db.fonts.slice(0, 3).forEach(font => {
      grid.innerHTML += createFontCard(font);
    });
  }

  function initFonts() {
    renderFontGrid(db.fonts);
  }

  function initDetail(fontId) {
    const font = db.fonts.find(f => f.id == fontId);
    if (!font) return navigate('fonts');

    document.getElementById('detail-name').innerText = font.name;
    document.getElementById('detail-author').innerText = "By " + font.designer;
    document.getElementById('detail-script').innerText = font.script;
    document.getElementById('detail-glyphs').innerText = font.glyphs + " Glyphs";
    document.getElementById('detail-price').innerText = "₹" + font.pricePersonal;
    
    // Setup Preview
    const input = document.getElementById('detail-input');
    input.classList.add(font.fontClass);
    input.value = font.previewText;

    // Add to Cart Logic
    document.getElementById('add-to-cart-btn').onclick = () => addToCart(font);
  }

  function initDashboard() {
    // Render Chart using Chart.js
    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['W1', 'W2', 'W3', 'W4'],
        datasets: [{
          label: 'Revenue',
          data: [1200, 1900, 3000, 5000],
          borderColor: '#007F8C',
          backgroundColor: '#007F8C',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
            x: { grid: { display: false, color: '#333' }, ticks: { color: '#fff' } },
            y: { grid: { color: '#333' }, ticks: { color: '#fff' } }
        }
      }
    });
  }

  function initCart() {
    const container = document.getElementById('cart-items');
    if (db.cart.length === 0) {
      container.innerHTML = `<div class="bg-white border-2 border-text p-12 text-center text-text/40 font-bold uppercase tracking-widest">Your cart is empty</div>`;
      updateCartSummary();
      return;
    }

    container.innerHTML = '';
    db.cart.forEach((item, index) => {
      container.innerHTML += `
        <div class="bg-white border-2 border-text p-6 flex justify-between items-center shadow-raw">
          <div>
            <h3 class="font-display text-xl font-bold">${item.name}</h3>
            <p class="text-xs font-bold uppercase tracking-widest text-text/60">${item.license} License</p>
          </div>
          <div class="flex items-center gap-6">
            <div class="font-bold text-xl">₹${item.price}</div>
            <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
          </div>
        </div>
      `;
    });
    updateCartSummary();
  }

  // --- HELPERS ---

  function createFontCard(font) {
    return `
      <div class="bg-white border-2 border-text shadow-raw hover:shadow-raw-teal transition-all group cursor-pointer" onclick="navigate('detail', ${font.id})">
        <div class="h-48 bg-card border-b-2 border-text flex items-center justify-center p-4 overflow-hidden relative">
           <div class="absolute top-2 left-2 text-[10px] font-bold uppercase tracking-widest bg-white border border-text px-1">${font.script}</div>
           <h3 class="text-6xl font-bold text-text group-hover:scale-110 transition-transform duration-300 ${font.fontClass} text-center dynamic-preview">${font.previewText}</h3>
        </div>
        <div class="p-5">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-display text-xl font-bold group-hover:text-teal transition-colors">${font.name}</h4>
            <span class="font-bold text-sm">₹${font.pricePersonal}</span>
          </div>
          <p class="text-xs font-bold text-text/50 uppercase tracking-widest mb-4">By ${font.designer}</p>
          <button class="w-full btn-outline py-2 text-xs">View Details</button>
        </div>
      </div>
    `;
  }

  function renderFontGrid(fonts) {
    const grid = document.getElementById('fonts-grid');
    const count = document.getElementById('font-count');
    grid.innerHTML = '';
    
    if (fonts.length === 0) {
      grid.innerHTML = `<div class="col-span-2 text-center p-12 font-bold text-text/40">No fonts found matching filters.</div>`;
      count.innerText = "0 Fonts";
      return;
    }

    count.innerText = `Showing ${fonts.length} fonts`;
    fonts.forEach(font => {
      grid.innerHTML += createFontCard(font);
    });
  }

  function applyFilters() {
    // Get checked scripts
    const scriptChecks = Array.from(document.querySelectorAll('#filter-script input:checked')).map(cb => cb.value);
    const catChecks = Array.from(document.querySelectorAll('#filter-cat input:checked')).map(cb => cb.value);
    
    let filtered = db.fonts;
    
    if(scriptChecks.length > 0) {
      filtered = filtered.filter(f => scriptChecks.includes(f.script));
    }
    if(catChecks.length > 0) {
      filtered = filtered.filter(f => catChecks.includes(f.category));
    }
    
    renderFontGrid(filtered);
  }

  function updateAllPreviews(text) {
    if(!text) return;
    document.querySelectorAll('.dynamic-preview').forEach(el => el.innerText = text);
  }
  
  function updateAllSizes(val) {
    document.querySelectorAll('.dynamic-preview').forEach(el => el.style.fontSize = val + 'px');
  }

  // --- CART LOGIC ---
  
  function updateLicensePrice(type) {
    // Only works on Detail page
    const fontId = parseInt(currentRouteParams); // Hacky storage of params
    // Real implementation would look up state
  }

  function addToCart(font) {
    const licenseType = document.querySelector('input[name="license"]:checked').value;
    const price = licenseType === 'personal' ? font.pricePersonal : font.priceCommercial;
    
    db.cart.push({
      id: font.id,
      name: font.name,
      license: licenseType,
      price: price
    });
    
    updateCartBadge();
    alert("Added to cart!");
  }

  function removeFromCart(index) {
    db.cart.splice(index, 1);
    initCart();
    updateCartBadge();
  }

  function updateCartBadge() {
    const badge = document.getElementById('cart-badge');
    badge.innerText = db.cart.length;
    badge.classList.remove('hidden');
    if(db.cart.length === 0) badge.classList.add('hidden');
  }

  function updateCartSummary() {
    const subtotal = db.cart.reduce((sum, item) => sum + item.price, 0);
    const tax = Math.round(subtotal * 0.18);
    const total = subtotal + tax;
    
    document.getElementById('cart-subtotal').innerText = "₹" + subtotal;
    document.getElementById('cart-tax').innerText = "₹" + tax;
    document.getElementById('cart-total').innerText = "₹" + total;
  }
  
  function handleUpload(e) {
    e.preventDefault();
    alert("Font submitted for review! Admin will check the .OTF files.");
    e.target.reset();
  }
  
  function setFontScriptPreview(script) {
     const input = document.getElementById('detail-input');
     if(script === 'kannada') { input.className = "w-full h-full bg-transparent border-none outline-none resize-none text-8xl font-bold leading-tight placeholder-text/20 font-kannada"; input.value = "ನಮಸ್ಕಾರ"; }
     if(script === 'english') { input.className = "w-full h-full bg-transparent border-none outline-none resize-none text-8xl font-bold leading-tight placeholder-text/20 font-display"; input.value = "Hello"; }
  }

  // Initial Load
  window.addEventListener('load', () => {
    // Check hash for direct links
    const hash = window.location.hash.replace('#', '');
    navigate(hash || 'home');
  });

</script>
</body>
</html>